<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Anonymous Feedback (Employee)</title>

	<style>
		body { font-family: Arial; background:#f4f4f4; margin:0; }
		.box { width:520px; margin:40px auto; background:#fff; padding:20px; border:1px solid #ddd; border-radius:6px; }
		h2 { margin-top:0; }
		label { display:block; margin-top:12px; font-weight:bold; }
		select, input, textarea { width:100%; box-sizing:border-box; padding:8px; margin-top:6px; border:1px solid #bbb; border-radius:4px; font-size:14px; }
		textarea { height:120px; resize:vertical; }
		button { margin-top:15px; padding:8px 12px; border:none; border-radius:4px; cursor:pointer; margin-right:8px; }
		.primary { background:#2d7ef7; color:#fff; }
		.dark { background:#444; color:#fff; }
		.note { font-size:12px; color:#555; margin-bottom:10px; }
		#msg { margin-top:12px; min-height:18px; font-size:14px; }
	</style>

	<script>
		window.onload = function () {
			var role = localStorage.getItem("role");
			var token = localStorage.getItem("token");

			if (!token || role !== "emp") {
				window.location.href = "index.html";
			}
		};

		function Logout() {
			localStorage.removeItem("role");
			localStorage.removeItem("token");
			window.location.href = "index.html";
		}

		function SubmitFeedbackHandler() {
			var department = document.getElementById("ddlDepartment").value;
			var category = document.getElementById("ddlCategory").value;
			var subject = document.getElementById("txtSubject").value.trim();
			var feedbackText = document.getElementById("txtFeedback").value.trim();

			var msg = document.getElementById("msg");
			msg.innerText = "";

			if (department === "" || category === "" || subject === "" || feedbackText === "") {
				msg.style.color = "red";
				msg.innerText = "Please fill out all fields.";
				return;
			}

			var token = localStorage.getItem("token");

			fetch("/api/feedback", {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
					"Authorization": "Bearer " + token
				},
				body: JSON.stringify({
					department: department,
					category: category,
					subject: subject,
					feedback_text: feedbackText
				})
			})
			.then(r => r.json())
			.then(data => {
				if (!data.ok) {
					msg.style.color = "red";
					msg.innerText = data.message || "Submit failed.";
					return;
				}

				msg.style.color = "green";
				msg.innerText = data.message;

				document.getElementById("ddlDepartment").value = "";
				document.getElementById("ddlCategory").value = "";
				document.getElementById("txtSubject").value = "";
				document.getElementById("txtFeedback").value = "";
			})
			.catch(() => {
				msg.style.color = "red";
				msg.innerText = "Server error. Make sure Node.js server is running.";
			});
		}
	</script>
</head>

<body>
	<div class="box">
		<h2>Anonymous Feedback (Employee)</h2>
		<p class="note">Submit anonymous feedback.</p>

		<label for="ddlDepartment">Department</label>
		<select id="ddlDepartment">
			<option value="">-- Select Department --</option>
			<option value="HR">HR</option>
			<option value="IT">IT</option>
			<option value="Finance">Finance</option>
			<option value="Operations">Operations</option>
			<option value="Other">Other</option>
		</select>

		<label for="ddlCategory">Category</label>
		<select id="ddlCategory">
			<option value="">-- Select Category --</option>
			<option value="Safety">Safety</option>
			<option value="Work Environment">Work Environment</option>
			<option value="Management">Management</option>
			<option value="Pay/Benefits">Pay/Benefits</option>
			<option value="Other">Other</option>
		</select>

		<label for="txtSubject">Subject</label>
		<input id="txtSubject" type="text" placeholder="Short subject..." />

		<label for="txtFeedback">Feedback</label>
		<textarea id="txtFeedback" placeholder="Write your feedback..."></textarea>

		<button class="primary" onclick="SubmitFeedbackHandler()">Submit</button>
		<button class="dark" onclick="Logout()">Logout</button>

		<div id="msg"></div>
	</div>
</body>
</html><h2></h2>