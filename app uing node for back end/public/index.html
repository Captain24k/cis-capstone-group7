<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Login</title>

	<style>
		body { font-family: Arial; background:#f4f4f4; margin:0; }
		.box { width:420px; margin:60px auto; background:#fff; padding:20px; border:1px solid #ddd; border-radius:6px; }
		h2 { margin-top:0; }
		label { display:block; margin-top:12px; font-weight:bold; }
		input { width:100%; box-sizing:border-box; padding:8px; margin-top:6px; border:1px solid #bbb; border-radius:4px; }
		button { margin-top:15px; padding:8px 12px; border:none; border-radius:4px; cursor:pointer; background:#2d7ef7; color:#fff; }
		.note { font-size:12px; color:#555; margin-bottom:10px; }
		#msg { margin-top:12px; min-height:18px; font-size:14px; }
	</style>

	<script>
		function setAuth(token, role) {
			localStorage.setItem("token", token);
			localStorage.setItem("role", role);
		}

		function LoginHandler() {
			var user = document.getElementById("txtId").value.trim();
			var pass = document.getElementById("txtPass").value.trim();
			var msg = document.getElementById("msg");

			msg.innerText = "";

			if (user === "" || pass === "") {
				msg.style.color = "red";
				msg.innerText = "Please enter ID and password.";
				return;
			}

			fetch("/api/login", {
				method: "POST",
				headers: { "Content-Type": "application/json" },
				body: JSON.stringify({ user: user, password: pass })
			})
			.then(r => r.json())
			.then(data => {
				if (!data.ok) {
					msg.style.color = "red";
					msg.innerText = data.message || "Login failed.";
					return;
				}

				setAuth(data.token, data.role);

				if (data.role === "emp") {
					window.location.href = "employee.html";
				} else if (data.role === "manager") {
					window.location.href = "manager.html";
				} else {
					msg.style.color = "red";
					msg.innerText = "Unknown role in database.";
				}
			})
			.catch(() => {
				msg.style.color = "red";
				msg.innerText = "Server error. Make sure Node.js server is running.";
			});
		}
	</script>
</head>

<body>
	<div class="box">
		<h2>Login</h2>

		<p class="note">
			Use your DB users table accounts.
		</p>

		<label for="txtId">User</label>
		<input id="txtId" type="text" placeholder="Enter user" />

		<label for="txtPass">Password</label>
		<input id="txtPass" type="password" placeholder="Enter password" />

		<button onclick="LoginHandler()">Login</button>

		<div id="msg"></div>
	</div>
</body>
</html>